<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Recibos - Condomínio Mandala II</title>
    <style>
      /* Variáveis de Cores e Estilos */
      :root {
        --primary-color: #007bff;
        --secondary-color: #6c757d;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --background-light: #f8f9fa;
        --text-dark: #343a40;
        --border-radius: 8px;
        --shadow-subtle: 0 4px 12px rgba(0, 0, 0, 0.1);
        --shadow-btn: 0 2px 4px rgba(0, 0, 0, 0.2);
        --input-padding: 12px;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        line-height: 1.6;
        background-color: var(--background-light);
        color: var(--text-dark);
        display: flex;
        justify-content: center;
      }

      .container {
        width: 100%;
        max-width: 700px;
        margin: 20px auto;
        padding: 30px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-subtle);
        background-color: white;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 15px;
      }

      .header h1 {
        color: var(--primary-color);
        font-size: 1.8rem;
        margin-bottom: 5px;
      }

      .header p {
        color: var(--secondary-color);
        font-size: 0.9rem;
        margin: 0;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text-dark);
      }

      select,
      input[type="text"] {
        width: 100%;
        padding: var(--input-padding);
        border: 1px solid #ced4da;
        border-radius: var(--border-radius);
        box-sizing: border-box;
        background-color: #fff;
      }

      button {
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: background-color 0.3s;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      #gerarRecibo {
        background-color: var(--success-color);
        margin-top: 10px;
      }

      #logoutBtn {
        background-color: var(--danger-color);
        float: right;
        margin-bottom: 20px;
      }

      /* Melhoria de Responsividade: Data Picker usa flexbox */
      .date-picker {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .date-picker select {
        flex: 1;
        min-width: 100px;
      }

      @media (max-width: 480px) {
        .date-picker select {
          min-width: 100%;
          flex-basis: 100%;
        }
      }

      /* Estilos de Impressão (para o popup) */
      @media print {
        body {
          margin: 0;
          padding: 0;
          font-size: 12pt;
          line-height: 1.4;
          background: white;
        }
        .container,
        #reciboApp {
          width: 100%;
          max-width: 100%;
          margin: 0;
          padding: 0;
          border: none;
          box-shadow: none;
        }
        .recibo {
          page-break-inside: avoid;
          margin: 0;
          padding: 10mm;
          border: none;
          width: 100%;
          height: auto;
          box-shadow: none;
        }
        button,
        .header,
        form {
          display: none !important;
        }
        @page {
          size: A4;
          margin: 15mm;
        }
      }
    </style>
  </head>
  <body>
    <div id="reciboApp" class="container">
      <div class="header">
        <h1>CONDOMÍNIO RESIDENCIAL MANDALA II</h1>
        <p>Rua Humberto de Campos, nº273, Bairro da Luz Nova Iguaçu RJ</p>
        <p>CEP 26.255-550</p>
      </div>

      <button type="button" id="logoutBtn">Sair</button>

      <form id="reciboForm" style="clear: both">
        <div class="form-group">
          <label for="bloco">Bloco:</label>
          <select id="bloco" required>
            <option value="">Selecione o Bloco</option>
            <option value="1">Bloco 1</option>
            <option value="2">Bloco 2</option>
          </select>
        </div>

        <div class="form-group">
          <label for="apartamento">Apartamento:</label>
          <select id="apartamento" required disabled>
            <option value="">Selecione o Apartamento</option>
          </select>
        </div>

        <div class="form-group">
          <label for="condomino">Condômino:</label>
          <select id="condomino" required disabled>
            <option value="">Selecione o Condômino</option>
          </select>
        </div>

        <div class="form-group">
          <label for="mesReferencia">Mês de Referência:</label>
          <select id="mesReferencia" required>
            <option value="">Selecione o Mês</option>
            <option value="01/2025">Janeiro/2025</option>
            <option value="02/2025">Fevereiro/2025</option>
            <option value="03/2025">Março/2025</option>
            <option value="04/2025">Abril/2025</option>
            <option value="05/2025">Maio/2025</option>
            <option value="06/2025">Junho/2025</option>
            <option value="07/2025">Julho/2025</option>
            <option value="08/2025">Agosto/2025</option>
            <option value="09/2025">Setembro/2025</option>
            <option value="10/2025">Outubro/2025</option>
            <option value="11/2025">Novembro/2025</option>
            <option value="12/2025">Dezembro/2025</option>
            <option value="01/2026">Janeiro/2026</option>
            <option value="02/2026">Fevereiro/2026</option>
            <option value="03/2026">Março/2026</option>
            <option value="04/2026">Abril/2026</option>
            <option value="05/2026">Maio/2026</option>
            <option value="06/2026">Junho/2026</option>
            <option value="07/2026">Julho/2026</option>
            <option value="08/2026">Agosto/2026</option>
            <option value="09/2026">Setembro/2026</option>
            <option value="10/2026">Outubro/2026</option>
            <option value="11/2026">Novembro/2026</option>
            <option value="12/2026">Dezembro/2026</option>
          </select>
        </div>

        <div class="form-group">
          <label for="valor">Valor do Condomínio (R$):</label>
          <input
            type="text"
            id="valor"
            inputmode="decimal"
            required
            placeholder="0,00"
          />
        </div>

        <div class="form-group">
          <label>Data do Recibo:</label>
          <div class="date-picker">
            <select id="dia" required>
              <option value="">Dia</option>
            </select>
            <select id="mes" required>
              <option value="">Mês</option>
              <option value="01">Janeiro</option>
              <option value="02">Fevereiro</option>
              <option value="03">Março</option>
              <option value="04">Abril</option>
              <option value="05">Maio</option>
              <option value="06">Junho</option>
              <option value="07">Julho</option>
              <option value="08">Agosto</option>
              <option value="09">Setembro</option>
              <option value="10">Outubro</option>
              <option value="11">Novembro</option>
              <option value="12">Dezembro</option>
            </select>
            <select id="ano" required>
              <option value="">Ano</option>
              <option value="2024">2024</option>
              <option value="2025">2025</option>
              <option value="2026">2026</option>
            </select>
          </div>
        </div>

        <button type="button" id="gerarRecibo">Gerar Recibo</button>
      </form>
    </div>

    <script>
      // --- 1. VERIFICAÇÃO DE ACESSO ---
      if (localStorage.getItem('isLoggedIn') !== 'true') {
          alert('Acesso negado. Por favor, faça login.');
          window.location.href = 'login.html'; // CORRIGIDO: Redireciona para login.html
      }

      document.getElementById('logoutBtn').addEventListener('click', function() {
          localStorage.removeItem('isLoggedIn');
          window.location.href = 'login.html'; // CORRIGIDO: Redireciona para login.html
      });


      // --- 2. LÓGICA DO RECIBO ---
      // ... (O restante do código de lógica do recibo é mantido)


      // --- 2. LÓGICA DO RECIBO ---
      const condominos = {
          "1": { "101": "Camila", "102": "Elizabeth", "201": "Luiz Emanoel / Cira", "202": "Ana / Bismarck", "301": "Luciane / Sidnei", "302": "Janaína" },
          "2": { "101": "Luizette", "102": "Luiz Carlos / Alzira", "201": "Ismênia", "202": "José Guerra", "301": "Vanessa / Wesley", "302": "Ruth" }
      };

      const blocoSelect = document.getElementById('bloco');
      const apartamentoSelect = document.getElementById('apartamento');
      const condominoSelect = document.getElementById('condomino');
      const mesReferenciaSelect = document.getElementById('mesReferencia');
      const valorInput = document.getElementById('valor');
      const diaSelect = document.getElementById('dia');
      const mesSelect = document.getElementById('mes');
      const anoSelect = document.getElementById('ano');
      const gerarReciboBtn = document.getElementById('gerarRecibo');

      function valorPorExtenso(valor) {
          const unidades = ["", "um", "dois", "três", "quatro", "cinco", "seis", "sete", "oito", "nove"];
          const dez_a_dezenove = ["dez", "onze", "doze", "treze", "quatorze", "quinze", "dezesseis", "dezessete", "dezoito", "dezenove"];
          const dezenas = ["", "dez", "vinte", "trinta", "quarenta", "cinquenta", "sessenta", "setenta", "oitenta", "noventa"];
          const centenas = ["", "cento", "duzentos", "trezentos", "quatrocentos", "quinhentos", "seiscentos", "setecentos", "oitocentos", "novecentos"];
          let valorStr = valor.toFixed(2);
          let partes = valorStr.split('.');
          let inteiro = parseInt(partes[0]);
          let centavos = parseInt(partes[1]);
          if (inteiro === 0 && centavos === 0) return "zero reais";
          let extenso = "";
          if (inteiro > 0) {
              if (inteiro === 1) { extenso += "um real"; }
              else if (inteiro < 1000) {
                  let c = Math.floor(inteiro / 100); let d = Math.floor((inteiro % 100) / 10); let u = inteiro % 10;
                  if (c > 0) {
                      extenso += centenas[c];
                      if (c === 1 && d === 0 && u === 0) extenso = "cem"; else if (c > 0 && (d > 0 || u > 0)) extenso += " e ";
                  }
                  if (d > 1) {
                      extenso += dezenas[d]; if (u > 0) extenso += " e " + unidades[u];
                  } else if (d === 1) {
                      extenso += dez_a_dezenove[u];
                  } else if (u > 0) {
                      extenso += unidades[u];
                  }
                  extenso += (extenso.includes("real") || extenso.includes("reais") ? "" : (inteiro === 1 ? " real" : " reais"));
              } else { extenso += "valor alto em reais"; }
          }
          if (inteiro > 1 && !extenso.includes("reais")) extenso += " reais";
          if (centavos > 0) {
              if (inteiro > 0) extenso += " e ";
              if (centavos === 1) {
                  extenso += "um centavo";
              } else if (centavos < 100) {
                  let d = Math.floor(centavos / 10); let u = centavos % 10;
                  if (d > 1) { extenso += dezenas[d]; if (u > 0) extenso += " e " + unidades[u]; }
                  else if (d === 1) { extenso += dez_a_dezenove[u]; }
                  else if (u > 0) { extenso += unidades[u]; }
                  extenso += (centavos === 1 ? " centavo" : " centavos");
              }
          }
          extenso = extenso.trim().toLowerCase();
          if (extenso.length > 0) { extenso = extenso.charAt(0).toUpperCase() + extenso.slice(1); }
          return extenso;
      }

      function formatarValor(valor) {
          let v = valor.replace(/\D/g, '');
          v = v.padStart(3, '0');
          let centavos = v.slice(-2);
          let reais = v.slice(0, -2);
          reais = reais.replace(/^0+/, '');
          if (reais === '') reais = '0';
          reais = reais.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
          return `${reais},${centavos}`;
      }

      function preencherDias() {
          diaSelect.innerHTML = '<option value="">Dia</option>';
          const mes = mesSelect.value;
          const ano = anoSelect.value;
          if (mes && ano) {
              const diasNoMes = new Date(ano, mes, 0).getDate();
              for (let i = 1; i <= diasNoMes; i++) {
                  const option = document.createElement('option');
                  option.value = i < 10 ? '0' + i : i;
                  option.textContent = i;
                  diaSelect.appendChild(option);
              }
          }
      }

      function preencherDataAtual() {
          const hoje = new Date();
          const dia = String(hoje.getDate()).padStart(2, '0');
          const mes = String(hoje.getMonth() + 1).padStart(2, '0');
          const ano = String(hoje.getFullYear());
          if (document.querySelector(`#ano option[value="${ano}"]`)) {
              anoSelect.value = ano;
              mesSelect.value = mes;
              preencherDias();
              diaSelect.value = dia;
          }
      }

      valorInput.addEventListener('input', function() {
          const start = this.selectionStart;
          const end = this.selectionEnd;
          let valorAntigo = this.value;
          this.value = formatarValor(valorAntigo);
          const novoLength = this.value.length;
          const diff = novoLength - valorAntigo.length;
          this.setSelectionRange(start + diff, end + diff);
      });

      blocoSelect.addEventListener('change', function() {
          const bloco = this.value;
          apartamentoSelect.innerHTML = '<option value="">Selecione o Apartamento</option>';
          condominoSelect.innerHTML = '<option value="">Selecione o Condômino</option>';
          if (bloco) {
              apartamentoSelect.disabled = false;
              const apartamentos = Object.keys(condominos[bloco]);
              apartamentos.forEach(ap => {
                  const option = document.createElement('option');
                  option.value = ap;
                  option.textContent = `Ap ${ap}`;
                  apartamentoSelect.appendChild(option);
              });
          } else {
              apartamentoSelect.disabled = true;
              condominoSelect.disabled = true;
          }
      });

      apartamentoSelect.addEventListener('change', function() {
          const bloco = blocoSelect.value;
          const apartamento = this.value;
          condominoSelect.innerHTML = '<option value="">Selecione o Condômino</option>';
          if (bloco && apartamento && condominos[bloco][apartamento]) {
              condominoSelect.disabled = false;
              const nomeCondomino = condominos[bloco][apartamento];
              const option = document.createElement('option');
              option.value = nomeCondomino;
              option.textContent = nomeCondomino;
              condominoSelect.appendChild(option);
              condominoSelect.value = nomeCondomino;
          } else {
              condominoSelect.disabled = true;
          }
      });

      mesSelect.addEventListener('change', preencherDias);
      anoSelect.addEventListener('change', preencherDias);

      preencherDataAtual();

      function gerarConteudoRecibo() {
          const valorInputLimpo = valorInput.value.replace(/\./g, '').replace(',', '.');
          const valor = parseFloat(valorInputLimpo);
          if (isNaN(valor)) return '';
          const valorFormatado = valor.toFixed(2).replace('.', ',');
          const valorExtenso = valorPorExtenso(valor);

          const mesRef = mesReferenciaSelect.value.split('/');
          const meses = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                          'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
          const mesReferenciaExtenso = `${meses[parseInt(mesRef[0]) - 1]} de ${mesRef[1]}`;

          const mesReciboExtenso = meses[parseInt(mesSelect.value) - 1];
          const dataRecibo = `${parseInt(diaSelect.value)} de ${mesReciboExtenso} de ${anoSelect.value}`;

          return `
              <!DOCTYPE html>
              <html lang="pt-BR">
              <head>
                  <meta charset="UTF-8">
                  <meta name="viewport" content="width=device-width, initial-scale=1.0">
                  <title>Recibo de Condomínio</title>
                  <style>
                      body { font-family: Arial, sans-serif; margin: 0; padding: 20px; line-height: 1.6; background: white; }
                      .container { max-width: 800px; margin: 0 auto; padding: 20px; }
                      .recibo { padding: 30px; border: 1px solid #007bff; border-radius: 8px; background-color: #f0f8ff; min-height: 250px; }
                      .recibo-header { text-align: center; margin-bottom: 25px; border-bottom: 2px solid #007bff; padding-bottom: 15px; }
                      .recibo-header h2 { font-size: 1.6rem; color: #007bff; margin: 0; }
                      .recibo-details { margin-bottom: 25px; font-size: 1.1rem; }
                      .recibo-details p { margin-bottom: 12px; }
                      .recibo-details strong { color: #343a40; }
                      .assinatura-area { display: flex; flex-direction: column; align-items: flex-end; margin-top: 50px; padding-top: 20px; border-top: 1px dashed #6c757d; }
                      .assinatura-line {
                          width: 200px;
                          border-bottom: 1px solid #000;
                          margin-bottom: 5px;
                          position: relative;
                          height: 40px;
                          display: flex;
                          justify-content: center;
                          align-items: flex-end;
                      }
                      .assinatura-line img {
                          position: absolute;
                          height: 50px;
                          bottom: 0px;
                          left: 50%;
                          transform: translateX(-50%);
                          max-width: 100%;
                          object-fit: contain;
                      }
                      .assinatura-text p { margin: 0; font-size: 0.95rem; text-align: right; }
                      .button-group { margin-top: 30px; text-align: center; }
                      #voltarRecibo { background-color: #dc3545; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
                      #voltarRecibo:hover { opacity: 0.9; }
                      @media print {
                          .button-group, #voltarRecibo { display: none !important; }
                          .recibo { border: none; background-color: white; }
                      }
                  </style>
              </head>
              <body onload="window.print();">
                  <div class="container">
                      <div class="recibo">
                          <div class="recibo-header">
                              <h2>RECIBO DE PAGAMENTO</h2>
                              <p>CONDOMÍNIO RESIDENCIAL MANDALA II</p>
                              <p>Rua Humberto de Campos, nº273, Bairro da Luz Nova Iguaçu RJ</p>
                          </div>

                          <div class="recibo-details">
                              <p>Recebi do Sr.(a) <strong>${condominoSelect.value}</strong> a quantia de <strong>R$ ${valorFormatado} (${valorExtenso})</strong> referente ao pagamento da taxa condominial do mês <strong>${mesReferenciaExtenso}</strong>.</p>
                              <p>Unidade: Bloco <strong>${blocoSelect.value}</strong> Apartamento: <strong>${apartamentoSelect.value}</strong></p>
                          </div>

                          <div class="assinatura-area">
                              <p>Nova Iguaçu, ${dataRecibo}</p>
                              <div class="assinatura-line">
                                  <img src="imagens/Rubrica_síndico.png" alt="Rubrica do Síndico">
                              </div>
                              <div class="assinatura-text">
                                  <p>Responsável pelo Condomínio</p>
                                  <p>Luiz Sales - Síndico</p>
                              </div>
                          </div>
                      </div>
                      <div class="button-group">
                          <button type="button" id="voltarRecibo" onclick="window.close();">Fechar Recibo</button>
                      </div>
                  </div>
              </body>
              </html>
          `;
      }

      gerarReciboBtn.addEventListener('click', function() {
          if (!blocoSelect.value || !apartamentoSelect.value || !condominoSelect.value ||
              !mesReferenciaSelect.value || !valorInput.value || !diaSelect.value ||
              !mesSelect.value || !anoSelect.value) {
              alert('Por favor, preencha todos os campos obrigatórios.');
              return;
          }

          const novaJanela = window.open('', '_blank');
          const conteudo = gerarConteudoRecibo();

          if (conteudo) {
              novaJanela.document.write(conteudo);
              novaJanela.document.close();
          } else {
              novaJanela.close();
              alert('Erro ao processar o valor. Verifique se o formato está correto.');
          }

          document.getElementById('reciboForm').reset();
          apartamentoSelect.disabled = true;
          condominoSelect.disabled = true;
          diaSelect.innerHTML = '<option value="">Dia</option>';
          preencherDataAtual();
      });
    </script>
  </body>
</html>
